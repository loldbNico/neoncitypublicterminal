     /* Prevent accidental text highlighting/selection while dragging/panning.
       Keep Area Details selectable (copy/paste). */
    body,
    .stage,
    .mapstage,
    .mapwrap,
    #mapStack,
    #svgHost,
    #logosLayer,
    #markersLayer,
    #labelsLayer,
    .topnav,
    .sidemenu,
    .layerToggles{
      user-select: none;
      -webkit-user-select: none;
    }
    #popupDetails,
    #popupDetails *{
      user-select: text;
      -webkit-user-select: text;
    }

    /* Panels */
    .hudpanel, .hudpopup, .dockpanel{
      background:
        radial-gradient(120% 120% at 30% 18%, rgba(96,143,255,.08), transparent 55%),
        linear-gradient(180deg, rgba(6,10,22,.86), rgba(2,6,18,.74));
      border: 1px solid rgba(96,143,255,.38);
      box-shadow:
        0 0 0 1px rgba(0,0,0,.55) inset,
        0 0 22px rgba(96,143,255,.10);
      position: relative;
    }
    .hudpanel::before, .hudpopup::before, .dockpanel::before{
      content:"";
      position:absolute; inset:-1px;
      border: 1px solid rgba(96,143,255,.16);
      pointer-events:none;
    }
    .hudpanel::after, .hudpopup::after, .dockpanel::after{
      content:"";
      position:absolute;
      left:-1px; top:-1px;
      width: 18px; height: 18px;
      border-left: 2px solid var(--yl);
      border-top: 2px solid var(--yl);
      opacity:.55;
      pointer-events:none;
    }

    /* =========================
       CUT-CORNER PANELS (ONLY)
       ========================= */
    #popupDetails{
      --cut: 16px;
      --pdStroke: 96, 143, 255;
      /* Let the base .hudpopup rules control size/position; ensure popup receives events and is on top */
      pointer-events: auto;
      z-index: 8;
      /* Remove the default square panel paint (the SVG provides the real cut-corner shape). */
      background: transparent;
      border: 0;
      box-shadow: none;

      /* Clip all panel contents (header/body/footer) to the cut-corner shape. */
      -webkit-clip-path: polygon(
        var(--cut) 0,
        calc(100% - var(--cut)) 0,
        100% var(--cut),
        100% calc(100% - var(--cut)),
        calc(100% - var(--cut)) 100%,
        0 100%,
        0 var(--cut)
      );
      clip-path: polygon(
        var(--cut) 0,
        calc(100% - var(--cut)) 0,
        100% var(--cut),
        100% calc(100% - var(--cut)),
        calc(100% - var(--cut)) 100%,
        0 100%,
        0 var(--cut)
      );

      /* Auto-size height to content; still cap to viewport and allow scroll when needed. */
      bottom: auto;
      height: auto;
      max-height: calc(
        100vh
        - var(--detailsTop, calc(var(--topbar-h) + 10px + 170px))
        - (14px + var(--dockH, 0px) + 14px)
      );
    }

    /* The polygon frame SVG is decorative; it should behave like a background layer,
       not a separate (empty) box that pushes the content down. */
    #popupDetails .pdSvg{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      pointer-events: none;
      z-index: 1;
    }
    #popupDetails .pdOutline{
      fill: none;
      stroke: rgba(var(--pdStroke), .92);
      stroke-width: 3;
      filter: drop-shadow(0 0 10px rgba(var(--pdStroke), .12));
    }
    #popupDetails .pdFill{ fill: rgba(6,10,22,.88); }
    #popupDetails .pdScan{ fill: rgba(255,255,255,.22); }
    #popupDetails .pdLines{ fill: url(#pdScanlines); opacity: .07; }

    #popupDetails::before{
      display:none;
    }

    /* Disable the global corner mark on this one */
    #popupDetails::after{ display:none; }

    /* Keep restricted state from reintroducing an extra boxed overlay layer. */
    #popupDetails.restricted::before,
    #popupDetails.restricted::after{
      display: none !important;
    }

    #popupDetails > .hudhead,
    #popupDetails > .hudbody,
    #popupDetails > .hudfoot{
      position: relative;
      z-index: 2;
    }

    /* Small side tab protrusion */
    #popupDetails .hudhead{
      position: relative;
    }
    #popupDetails .hudhead::before{
      content:"";
      position:absolute;
      left: -14px;
      top: 10px;
      width: 18px;
      height: 22px;
      background: rgba(6,10,22,.55);
      border: 1px solid var(--line2);
      border-right: none;
      clip-path: polygon(0 0, 100% 6px, 100% 100%, 0 100%);
      pointer-events:none;
    }

    /* Little top tab */
    #popupDetails .hudhead::after{
      content:"";
      position:absolute;
      left: 22px;
      top: -10px;
      width: 76px;
      height: 12px;
      background: rgba(6,10,22,.55);
      border: 1px solid var(--line2);
      border-bottom: none;
      clip-path: polygon(0 100%, 12px 0, 100% 0, 100% 100%);
      pointer-events:none;
    }

    /* Headers/Footers */
    .hudhead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(96,143,255,.32);
      background:
        linear-gradient(90deg, rgba(96,143,255,.28), rgba(6,10,22,.55) 58%);
      text-transform: uppercase;
      letter-spacing: 1.2px;
      font-size: 12px;
    }
    .hudtitle{ color: rgba(96,143,255,.96); text-shadow: 0 0 10px rgba(96,143,255,.12); }
    .hudmeta{ color: var(--yl); text-shadow: 0 0 10px rgba(var(--ylRGB), .10); }
    .hudbody{ padding: 12px; }
    .hudfoot{
      display:flex; justify-content:space-between;
      padding: 8px 12px;
      border-top: 1px solid rgba(96,143,255,.22);
      color: rgba(215,230,255,.52);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* MAP/INTEL footer content */
    #popupDetails .hudfoot{
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      gap: 6px;
      /* Match bottom padding thickness to side padding */
      padding: 12px;
    }
    #popupDetails .hudfoot > :first-child{
      padding-top: 0;
      color: rgba(96,143,255,.95);
      font-weight: 800;
      letter-spacing: 2px;
    }

    /* When the details panel is restricted-themed, MAP/INTEL should follow that palette */
    #popupDetails.restricted .hudfoot > :first-child{
      color: rgba(var(--restrictedTextRGB), .95);
      text-shadow: 0 0 10px rgba(var(--restrictedRGBHot), .22);
    }
    #popupDetails #detailFoot{
      width: 100%;
      display:flex;
      flex-direction:column;
      gap: 6px;
      text-transform: none;
      letter-spacing: .4px;
      font-size: 12px;
      color: rgba(215,230,255,.72);
    }
    #popupDetails .intelLabel{
      font-size: 12px;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: rgba(96,143,255,.48);
      font-weight: 700;
    }
    #popupDetails.restricted .intelLabel{
      color: rgba(var(--restrictedTextRGB), .52);
      text-shadow: 0 0 10px rgba(var(--restrictedRGBHot), .16);
    }
    #popupDetails .intelList{ display:flex; flex-direction:column; gap: 6px; }
    #popupDetails .intelRow{ display:flex; align-items:center; gap: 10px; }
    #popupDetails .intelLogo{
      width: 65px; height: 65px;
      object-fit: contain;
      filter: drop-shadow(0 0 10px rgba(0,0,0,.55));
      opacity: .92;
    }
    #popupDetails .intelName{
      color: rgba(var(--ylRGB), .86);
      text-shadow: 0 0 12px rgba(var(--ylRGB), .10);
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 15px;
    }
    #popupDetails.restricted .intelName{
      color: rgba(var(--restrictedTextRGB), .95);
      text-shadow: 0 0 12px rgba(var(--restrictedRGBHot), .22);
    }
    #popupDetails .intelDim{ color: rgba(215,230,255,.40); }

    /* Restricted MAP/INTEL warning */
    #popupDetails .intelWarning{
      position: relative;
      width: 100%;
      padding: 10px 10px;
      border: 1px solid rgba(96,143,255,.24);
      background:
        linear-gradient(180deg, rgba(0,0,0,.52), rgba(0,0,0,.22)),
        repeating-linear-gradient(0deg, rgba(96,143,255,.06), rgba(96,143,255,.06) 1px, transparent 1px, transparent 14px);
      overflow: hidden;
    }
    #popupDetails.restricted .intelWarning{
      border-color: rgba(var(--restrictedRGB), .55);
      box-shadow: 0 0 18px rgba(var(--restrictedRGBHot), .10);
      background:
        linear-gradient(180deg, rgba(0,0,0,.62), rgba(0,0,0,.26)),
        repeating-linear-gradient(0deg, rgba(var(--restrictedRGB), .10), rgba(var(--restrictedRGB), .10) 1px, transparent 1px, transparent 14px);
    }
    #popupDetails .intelWarning::after{
      content:"";
      position:absolute;
      inset: -2px;
      pointer-events:none;
      background:
        linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent),
        linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 6px);
      mix-blend-mode: screen;
      opacity: .22;
      animation: intelGlitch 1.25s steps(2, start) infinite;
    }
    #popupDetails .intelWarnTitle{
      font-weight: 900;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(96,143,255,.92);
    }
    #popupDetails.restricted .intelWarnTitle{
      color: rgba(var(--restrictedTextRGB), .96);
      text-shadow: 0 0 12px rgba(var(--restrictedRGBHot), .24);
    }
    #popupDetails .intelWarnBody{
      margin-top: 6px;
      font-size: 12px;
      line-height: 1.25;
      color: rgba(215,230,255,.64);
    }
    #popupDetails.restricted .intelWarnBody{
      color: rgba(var(--restrictedTextRGB), .80);
    }
    #popupDetails .intelWarnBody .hard{
      font-weight: 800;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(var(--ylRGB), .86);
    }
    #popupDetails.restricted .intelWarnBody .hard{
      color: rgba(var(--restrictedTextRGB), .95);
    }
    #popupDetails .intelWarnBody .stamp{
      display:inline-block;
      padding: 2px 6px;
      margin-top: 8px;
      border: 1px solid rgba(96,143,255,.34);
      color: rgba(96,143,255,.72);
      letter-spacing: 1.6px;
      text-transform: uppercase;
      font-size: 10px;
    }
    #popupDetails.restricted .intelWarnBody .stamp{
      border-color: rgba(var(--restrictedRGB), .55);
      color: rgba(var(--restrictedTextRGB), .80);
    }
    @keyframes intelGlitch{
      0%{ transform: translate(0,0); opacity:.22; }
      20%{ transform: translate(-2px, 1px); opacity:.30; }
      40%{ transform: translate(2px, -1px); opacity:.26; }
      60%{ transform: translate(-1px, 0); opacity:.34; }
      80%{ transform: translate(1px, -1px); opacity:.28; }
      100%{ transform: translate(0,0); opacity:.22; }
    }

